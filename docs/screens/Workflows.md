Техническое задание: Интеграция с рабочими процессами (Workflows)
1. Общее описание и назначение функциональности
Интеграция с "Workflows" предназначена для связывания маркетинговых активностей (Activities) с определенными бизнес-процессами в компании. Например, планирование кампании может требовать формального утверждения, а создание тактики, такой как "цифровая реклама", может инициировать процесс создания соответствующих рекламных материалов.
Эта функциональность позволяет автоматизировать и стандартизировать процессы, связанные с маркетинговым планированием, путем двустороннего обмена данными между маркетинговой активностью (в модуле Plan) и связанным с ней рабочим процессом, который управляется в модуле Work Management.
2. Архитектура и ключевые сущности
Интеграция строится на связи между двумя основными объектами:
• Тип активности (Activity Type): Шаблон для создания активностей в модуле Plan. Администратор настраивает его для определения атрибутов, иерархических правил и, в данном случае, связи с рабочим процессом.
• Тип рабочего процесса (Workflow Type): Шаблон для стандартизированного процесса, управляемого в модуле Work Management. Он содержит набор так называемых "переменных" (variables), которые представляют собой поля данных для конкретного процесса.
Связь настраивается на уровне шаблонов: один Тип активности может быть связан с одним Типом рабочего процесса.
3. Административный интерфейс: Настройка интеграции
Администраторы настраивают интеграцию на экране конфигурации типов активностей.
3.1. Экран конфигурации типа активности (Settings > Activity Types)
При создании или редактировании типа активности администратору должны быть доступны следующие опции для настройки интеграции с Workflows:
1. Выбор типа рабочего процесса (Workflow Type):
    ◦ Элемент интерфейса: Выпадающий список.
    ◦ Содержимое: Список всех доступных типов рабочих процессов (Process types), созданных в модуле Work Management.
    ◦ Поведение: Позволяет выбрать один тип рабочего процесса для связи с текущим типом активности. По умолчанию поле пустое (интеграция отключена).
2. Настройка атрибутов для синхронизации данных:
    ◦ После выбора типа рабочего процесса для каждого атрибута, назначенного данному типу активности, должны появиться два дополнительных поля: Workflow Type Variable и Sync Direction.
    ◦ Поле Workflow Type Variable:
        ▪ Элемент интерфейса: Текстовое поле для ввода.
        ▪ Назначение: Сюда администратор должен ввести точное техническое имя (Technical Name) переменной из связанного типа рабочего процесса. Это имя необходимо получить из настроек соответствующего Datasheet Layout в модуле Work Management.
    ◦ Поле Sync Direction (Направление синхронизации):
        ▪ Элемент интерфейса: Выпадающий список.
        ▪ Назначение: Определяет, какая из систем (Plan или Workflows) является "источником правды" для данного поля, то есть где данные управляются, а куда они только копируются.
        ▪ Опции:
            • From Activity (Из Активности): Данные, введенные в атрибут активности, будут копироваться в связанную переменную workflow.
            • From Workflow (Из Workflow): Данные, введенные в переменную workflow, будут копироваться в связанный атрибут активности.
            • None (Нет): Синхронизация для этого атрибута отключена (значение по умолчанию).
Важное ограничение: Редактирование полей Workflow Type и Sync Direction должно быть заблокировано, если уже существует хотя бы одна активность данного типа.
4. Пользовательский интерфейс: Взаимодействие с Workflows
Пользователи взаимодействуют с функциональностью Workflows при создании и редактировании активностей.
4.1. Помощник создания активности (Activity Setup Assistant)
• Назначение: Позволяет настроить запуск связанного рабочего процесса при создании новой активности.
• Реализация: Если для выбранного типа активности настроена связь с Workflow, в мастере создания активности должен появиться дополнительный шаг "Workflow" после шага "Impact".
• Элементы шага "Workflow":
    ◦ Чекбокс "Automatically create the workflow":
        ▪ Поведение: Если чекбокс отмечен, рабочий процесс будет запущен автоматически сразу после создания активности. Если не отмечен, пользователь сможет запустить его вручную позже.
        ▪ Состояние по умолчанию: Зависит от настроек, управляемых администратором.
• Завершение: После нажатия "Submit" активность создается. Если был отмечен чекбокс, связанный рабочий процесс автоматически запускается в фоновом режиме.
4.2. Панель деталей активности (Details Panel)
• Назначение: Управление и синхронизация данных с уже запущенным рабочим процессом.
• Элементы интерфейса:
    ◦ Кнопка Open Workflow: Должна появляться над вкладками (Details, Budget и т.д.), если с активностью связан рабочий процесс. Клик по этой кнопке перенаправляет пользователя на страницу соответствующего рабочего процесса в модуле Work Management.
    ◦ Действие Sync Activity:
        ▪ Расположение: В меню действий (...) в нижней части панели деталей.
        ▪ Назначение: Принудительно запускает процесс синхронизации данных между активностью и связанным с ней workflow.
        ▪ Поведение: При нажатии система копирует данные из полей-источников в поля-приемники в соответствии с настройками Sync Direction, сделанными администратором.
5. Сценарии использования и логика работы
1. Создание и автоматический запуск:
    ◦ Пользователь создает активность типа "Вебинар".
    ◦ Для этого типа настроена связь с workflow "Проведение вебинара" и опция автозапуска.
    ◦ На шаге "Workflow" пользователь оставляет чекбокс автозапуска включенным и нажимает "Submit".
    ◦ Система создает активность, автоматически запускает связанный с ней рабочий процесс и копирует в него данные из полей, настроенных на синхронизацию From Activity.
2. Ручной запуск и синхронизация:
    ◦ Пользователь создает активность, но на шаге "Workflow" снимает галочку автозапуска, так как детали процесса еще не определены.
    ◦ Позже, когда все готово, он открывает панель деталей активности и через меню действий (...) или кнопку Open Workflow инициирует запуск процесса вручную (механизм ручного запуска описан как возможный, но его точный интерфейс в источниках не детализирован).
    ◦ В ходе работы над процессом в модуле Work Management меняется статус (например, "В работе"). Это поле настроено на синхронизацию From Workflow.
    ◦ Пользователь в панели деталей активности нажимает Sync Activity. Статус в атрибуте активности обновляется на "В работе".
3. Просмотр и редактирование связанных данных:
    ◦ Пользователь открывает активность и видит в ее атрибутах данные, которые были синхронизированы из workflow (например, ID кампании из Salesforce).
    ◦ Пользователь хочет внести изменения в сам процесс. Он нажимает кнопку Open Workflow, переходит в соответствующий интерфейс и вносит правки.