Техническое задание: Экран управления инвестициями ("Investments")
1. Общее описание и назначение экрана
Экран "Investments" является основным рабочим пространством для ввода, отслеживания и управления данными о маркетинговых расходах. Он позволяет пользователям детализировать бюджет, сравнивать плановые показатели с прогнозируемыми, фактическими и зафиксированными (committed) затратами, а также связывать конкретные статьи расходов с маркетинговыми активностями. Этот экран — центральный элемент для bottom-up планирования, где детализированные инвестиции в совокупности должны соответствовать top-down целям бюджета.
Экран должен быть доступен по клику на пункт "Investments" в основной навигационной панели.
2. Структура и основные компоненты экрана
Экран "Investments" разделен на четыре ключевые области:
1. Навигация по планам инвестиций (Investment Plan Navigation): Выпадающий список в верхней левой части для быстрого переключения между различными инвестиционными планами, к которым у пользователя есть доступ.
2. Рабочая область (Workspace): Основная часть экрана, состоящая из двух взаимосвязанных панелей:
    ◦ Иерархия инвестиций (Hierarchy): Левая панель, отображающая структуру категорий, подкатегорий и статей расходов (line items).
    ◦ Таблица данных о расходах (Spend Data Grid): Правая панель, содержащая столбцы с финансовыми данными (план, прогноз, PO, фактические затраты), обычно с разбивкой по месяцам или кварталам.
3. Панель управления видом (View Controls): Набор фильтров и настроек над таблицей для управления отображаемыми данными.
4. Карточки с ключевыми показателями (Performance Insight Cards): Информационные виджеты над рабочей областью, отображающие агрегированные метрики, такие как общий бюджет, остаток для планирования и соответствие стратегическим целям.
3. Детальное описание компонентов и их функциональности
3.1. Навигация по планам инвестиций
• Назначение: Обеспечить быстрый доступ к разным инвестиционным планам.
• Элемент: Выпадающий список, расположенный в левом верхнем углу.
• Поведение:
    ◦ Отображает все инвестиционные планы, доступные пользователю.
    ◦ Текущий активный план должен быть подсвечен (например, курсивом).
    ◦ Пользователь может ввести название плана для быстрого поиска.
    ◦ При выборе нового плана вся рабочая область (иерархия и таблица данных) обновляется для отображения выбранного плана.
    ◦ Система должна запоминать последний открытый план и отображать его при следующем входе на экран "Investments".
3.2. Рабочая область (Workspace)
3.2.1. Иерархия инвестиций (Hierarchy)
• Назначение: Структурирование статей расходов для удобного управления и анализа.
• Структура: Иерархия состоит из следующих элементов:
    ◦ Категории (Category): Верхнеуровневые папки для группировки расходов. Создаются кнопкой Category.
    ◦ Подкатегории (Sub-category): Вложенные папки для дальнейшей детализации. Могут быть вложены друг в друга.
    ◦ Статьи расходов (Line Item): Основные элементы, для которых вводятся финансовые данные. Только на этом уровне можно вводить суммы затрат.
    ◦ Резервы (Placeholder): Специальный тип статьи расходов для резервирования средств на этапе планирования, когда конкретные детали еще неизвестны. Отображаются курсивом.
• Интерактивность:
    ◦ Клик по названию категории, статьи или резерва должен выделять соответствующую строку.
    ◦ Наличие иконок-стрелок для сворачивания/разворачивания вложенных элементов.
    ◦ Иконка панели деталей (Panel icon): Клик по этой иконке (справа от названия) открывает панель деталей для выбранного элемента.
    ◦ Индикаторы связи с активностями: Элементы, связанные с активностями из модуля "Activities", должны иметь специальную иконку (Connected) и быть подсвечены желтым цветом.
• Действия: Над иерархией должны быть кнопки для создания новых элементов (Category, Sub-category, Line Item, Placeholder) и удаления (Delete).
3.2.2. Таблица данных о расходах (Spend Data Grid)
• Назначение: Ввод и отображение финансовых данных по статьям расходов.
• Структура:
    ◦ Строки соответствуют элементам из иерархии инвестиций.
    ◦ Столбцы представляют собой финансовые показатели (например, Jan Plan, Jan Forecast, Q1 Actuals).
    ◦ Строка "Grand Total": Верхняя строка, которая автоматически суммирует все значения в столбцах по всему плану инвестиций. Аналогичные итоги должны подсчитываться и для категорий/подкатегорий.
• Функциональность:
    ◦ Ввод данных: Пользователь может вводить числовые значения напрямую в ячейки, соответствующие статьям расходов (белые ячейки). Ячейки для категорий и итогов (серые) должны быть нередактируемыми.
    ◦ Встроенный калькулятор: Ячейки для ввода сумм должны поддерживать математические операции (+, -, *, /) при вводе, начиная со знака =.
    ◦ Многовалютность: Через контекстное меню ячейки (правый клик) должна быть доступна опция "Set Multi-currency Value", позволяющая ввести сумму в другой валюте, которая будет автоматически конвертирована в основную валюту плана.
    ◦ Тегирование статуса прогноза: Ячейки в столбцах прогноза (Forecast) должны иметь цветной индикатор-точку слева, клик по которой открывает меню для выбора статуса (Forecast, Committed, Occurred).
3.3. Панель управления видом (View Controls)
• Расположение: Над таблицей данных.
• Основные элементы:
    ◦ View: Выпадающий список для выбора предопределенных наборов видимых столбцов (например, "Monthly Investment", "Q1 View").
    ◦ Group: Позволяет сгруппировать статьи расходов по значению одного из атрибутов из панели деталей (например, по целевой аудитории), вместо стандартной иерархии.
    ◦ Filter by Scenario: Фильтрация статей расходов по тегам сценариев (15% Increase, Cancelled и т.д.).
    ◦ Filter by Forecast Status: Фильтрация для отображения только тех сумм в столбцах прогноза, которые имеют определенный статус.
    ◦ Filter by Activity Funding: Фильтр, позволяющий показать только те инвестиции, которые уже связаны (или, наоборот, не связаны) с активностями.
    ◦ Show $0 Rows: Чекбокс для скрытия/отображения строк, не имеющих никаких финансовых данных.
3.4. Панель деталей (Details Panel)
• Активация: Открывается по клику на иконку панели (Panel icon) для любого элемента иерархии.
• Назначение: Просмотр и редактирование детальной информации (атрибутов) для выбранного элемента инвестиций.
• Структура:
    ◦ В заголовке отображается название элемента, его Uptempo ID и Persistent ID.
    ◦ Содержит несколько вкладок: Details, Metrics, Activities и др..
    ◦ Вкладка Details: Содержит набор настраиваемых полей (атрибутов), таких как "Objective", "Target Audience", "Product" и т.д., которые используются для классификации инвестиций и последующей отчетности. Атрибуты могут быть сгруппированы администратором.
    ◦ Вкладка Activities: Позволяет просматривать и управлять связями данного элемента инвестиций с маркетинговыми активностями из модуля "Plan". Отсюда можно инициировать привязку новой активности (Connect Activity) или открыть панель распределения средств (Open Activity Funding Panel).
3.5. Управление связями с активностями
• Процесс:
    1. Пользователь открывает панель деталей для статьи расходов и переходит на вкладку Activities.
    2. Нажимает Connect Activity.
    3. В открывшемся модальном окне отображается иерархия активностей, где можно выбрать одну или несколько для привязки.
    4. После привязки средства инвестиции можно распределить между активностями.
• Типы распределения:
    ◦ Автоматическое (Automatic Allocation): Если к инвестиции привязана только одна активность, ей автоматически выделяется 100% средств.
    ◦ Ручное (Manual Allocation): Если привязано несколько активностей, пользователь должен вручную распределить средства между ними, используя панель Activity Funding Panel. Сумма распределения не может превышать 100%.
    ◦ Авто-распределение (Auto Distribution): Администратор может настроить автоматическое распределение средств в одних столбцах (например, Actuals) на основе пропорций, заданных в других (например, Forecast).
