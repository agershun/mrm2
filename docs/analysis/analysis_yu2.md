Здравствуйте! Я внимательно изучил предоставленные вами файлы с описанием маркетинговых кампаний и продуктовой стратегии ("МТС Защитник", "NUUM", "СберЗдоровье"), а также детально проанализировал функциональность вашей MRM-системы Utempo.

Система Utempo уже обладает мощным ядром для планирования, бюджетирования и моделирования кампаний с помощью ИИ. Однако анализ реальных, сложных продуктовых и маркетинговых стратегий, таких как у МТС "Защитник" или охватных кампаний NUUM и СберЗдоровье, выявляет ряд дополнительных требований. Эти дополнения позволят системе более эффективно управлять маркетингом в крупных, продуктово-ориентированных организациях со сложной структурой.

Ниже приведены подробные требования и предложения по расширению функциональности и структуры данных вашей системы, основанные на этом анализе.

### Подробные требования к системе в дополнение к существующей функциональности

**1. Поддержка Продуктово-ориентированного планирования:**
*   **Анализ:** Презентация "МТС Защитник" — это не просто маркетинговая кампания, а полноценная продуктовая стратегия. В ней цели маркетинга неразрывно связаны с развитием продукта (бэклог фичей), миграцией пользователей между версиями и работой продуктовых команд с собственными метриками. Текущая структура Utempo ориентирована на "кампании" и "активности", но не имеет сущности "Продукт" как центрального объекта планирования.
*   **Требование:** **Система должна поддерживать "Продукт" как объект верхнего уровня**, к которому привязываются маркетинговые активности, бюджеты и KPI. Это позволит:
    *   Связывать маркетинговые кампании (Activities) с конкретными продуктами или даже отдельными фичами из бэклога.
    *   Агрегировать маркетинговые затраты и результаты на уровне продукта.
    *   Визуализировать, как маркетинговые усилия поддерживают продуктовую дорожную карту (например, кампания по продвижению новой фичи "Обратная связь по номерам").

**2. Управление многоуровневыми и сложными KPI:**
*   **Анализ:** В стратегии "Защитника" используется сложная иерархия метрик: от бизнес-KPI (Выручка, SU, PU) и метрик удовлетворенности (NPS) до специфических продуктовых (Detection Rate, Retention, LTV, MAU виджета) и командных метрик. Текущая таблица `KPIs` в Utempo является простым справочником.
*   **Требование:** Необходимо создать **продвинутый модуль управления KPI**, который позволит:
    *   **Категоризировать KPI** по типам: "Бизнес", "Продуктовые", "Маркетинговые", "Командные".
    *   **Создавать иерархию KPI**, где можно будет моделировать, как операционные метрики (например, MAU) влияют на достижение целей верхнего уровня (например, Выручка).
    *   **Привязывать KPI не только к активностям, но и к Продуктам, Командам и сотрудникам**, как это показано в ролевой модели "Защитника".

**3. Управление командами и ресурсами:**
*   **Анализ:** В презентации "Защитника" подробно описана структура команды, ее развитие, ролевая модель и распределение FTE (Full-Time Equivalent). Планирование бюджета включает CAPEX и OPEX, в том числе ФОТ для новых и существующих сотрудников. Система Utempo управляет маркетинговыми активностями, но не ресурсами, которые их выполняют.
*   **Требование:** Система должна включать **модуль управления ресурсами**, позволяющий:
    *   Создавать профили команд и сотрудников.
    *   **Аллоцировать FTE** на продукты и маркетинговые кампании.
    *   Планировать и отслеживать **затраты на команду (ФОТ)** как часть общего бюджета кампании или продукта, связывая их с `Investments`.

**4. Поддержка мультиканальных медиапланов с детализацией до площадки:**
*   **Анализ:** Медиаплан для NUUM представляет собой детальный список размещений в конкретных Telegram-каналах с указанием их названия, ссылки, категории, стоимости, подписчиков и прогнозных показов. Текущие таблицы Utempo `MediaMixItems` и `MediaPlanItems` оперируют общими понятиями ("channel_name", "vendor"), чего недостаточно для управления такими закупками.
*   **Требование:** Необходимо **расширить возможности медиапланирования**, добавив:
    *   **Справочник площадок (Placements/Venues)**, где можно хранить информацию о конкретных Telegram-каналах, блогерах, сайтах, включая ссылки, статистику (подписчики, охваты) и прайс-листы.
    *   Возможность в `MediaPlanItems` выбирать **конкретную площадку** из справочника, а не просто вводить текстовое название.

**5. Географическое планирование и бюджетирование:**
*   **Анализ:** Кампания "СберЗдоровье" имеет четкое географическое деление бюджета и KPI по 5 городам. Текущая модель данных Utempo не имеет выделенного поля для географии на уровне кампаний или бюджетов.
*   **Требование:** Система должна поддерживать **географию как ключевой атрибут**. Это требует:
    *   **Иерархического справочника географии** (страна, регион, город).
    *   Возможности **привязывать кампании (`Campaigns`), активности (`Activities`) и статьи бюджета (`Investments`) к конкретным локациям** из этого справочника.
    *   Функционала для фильтрации, группировки и агрегации отчетов по географическому признаку.

### Какие дополнительные таблицы и поля нужны

Чтобы реализовать описанные выше требования, потребуется расширить существующую модель данных Utempo.

#### 1. Модификация существующих таблиц

| **Таблица** | **Новые/Измененные поля** | **Обоснование** |
| :--- | :--- | :--- |
| **Activities** | `product_id: FK` (связь с новой таблицей Products)<br>`geography_id: FK` (связь с новым справочником Geography) | Позволяет напрямую связать маркетинговую активность с продуктом и географией, что необходимо для продуктово-ориентированного и регионального планирования. |
| **Investments** | `product_id: FK`<br>`team_id: FK` (связь с новой таблицей Teams)<br>`geography_id: FK`<br>`cost_type: Enum ['CAPEX', 'OPEX']` | Позволяет бюджетировать затраты (включая ФОТ команды) в разрезе продуктов, команд и географии, а также разделять CAPEX/OPEX, как в плане "Защитника". |
| **KPIs** | `kpi_category: Enum ['Business', 'Product', 'Marketing', 'Team']`<br>`parent_kpi_id: FK` (self-referencing) | Расширяет функциональность KPI, позволяя их категоризировать и строить иерархию для более глубокого анализа. |
| **MediaPlanItems** | `placement_id: FK` (связь с новой таблицей Placements)<br>`geography_id: FK` | Детализирует медиаплан до конкретной площадки (Telegram-канала) и позволяет планировать размещения по городам. |
| **Campaigns** | `product_id: FK` | Добавляет связь с продуктом на самом раннем этапе ИИ-моделирования кампании. |

#### 2. Новые таблицы

| **№** | **Название таблицы** | **Описание** | **Ключевые поля** | **Обоснование** |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **Products** | Справочник продуктов компании. Центральная сущность для продуктово-ориентированного маркетинга. | `product_id: PK`<br>`name: String`<br>`product_owner_id: FK Users`<br>`status: Enum ['active', 'development', 'legacy']` | Реализует требование по поддержке "Продукта" как объекта верхнего уровня. Позволяет агрегировать все маркетинговые усилия и бюджеты вокруг продуктов. |
| 2 | **Teams** | Справочник команд и их состав. | `team_id: PK`<br>`name: String`<br>`team_lead_id: FK Users` | Необходимо для ресурсного планирования, аллокации FTE и отслеживания затрат на команду. |
| 3 | **TeamAllocations** | Таблица для аллокации ресурсов (FTE) команд на продукты или крупные кампании. | `allocation_id: PK`<br>`team_id: FK`<br>`product_id: FK`<br>`activity_id: FK`<br>`fte_allocated: Decimal`<br>`period: DateRange` | Позволяет реализовать планирование и учет FTE, как это подробно описано в стратегии "Защитника". |
| 4 | **KPIAssignments** | Таблица для привязки KPI к различным сущностям (продуктам, командам, сотрудникам). | `assignment_id: PK`<br>`kpi_id: FK`<br>`entity_type: Enum ['Product', 'Team', 'User']`<br>`entity_id: String` | Реализует требование по гибкому назначению KPI не только активностям, но и продуктам и командам в соответствии с их ролевой моделью. |
| 5 | **Placements** | Справочник рекламных площадок (Telegram-каналы, блогеры, сайты и т.д.). | `placement_id: PK`<br>`name: String`<br>`url: String`<br>`category: String`<br>`subscribers: Integer`<br>`avg_reach: Integer` | Позволяет управлять детальными медиапланами с закупками в конкретных каналах, как в кампании NUUM, и хранить их характеристики. |
| 6 | **Geography** | Иерархический справочник географических локаций. | `geography_id: PK`<br>`name: String`<br>`parent_id: FK`<br>`type: Enum ['Country', 'Region', 'City']` | Централизует управление географией, что необходимо для планирования и отчетности по кампаниям, таким как "СберЗдоровье". |

Внедрение этих дополнений позволит вашей MRM-системе выйти за рамки инструмента для управления кампаниями и стать комплексной платформой для стратегического маркетингового планирования в современных, продуктово-ориентированных компаниях.