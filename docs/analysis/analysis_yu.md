# Техническое задание на доработку MRM-системы

## Функциональные требования

### 1. Поддержка многоуровневой иерархии и продуктово-ориентированного планирования

**Требование:** Система должна поддерживать:
- **Продукт как объект верхнего уровня** - центральная сущность для планирования
- **Многоуровневую иерархию активностей**: Программа → Кампания/Флайт → Тактика → Размещение
- Возможность создавать вложенные структуры (например, "Программа ХХХ H1'24" → "ФРК Смотри-Снимай-Зарабатывай" → конкретные тактики)
- Корректную агрегацию бюджетов и результатов на разных уровнях
- Связывание маркетинговых кампаний с конкретными продуктами или фичами из бэклога

### 2. Географическое планирование и бюджетирование

**Требование:** Полноценная поддержка географии как ключевого атрибута:
- Планирование бюджетов и KPI в разрезе городов, регионов или групп городов (например, "Города-миллионники")
- Фильтрация и группировка активностей в календаре и отчетах по географическому признаку
- Агрегация (roll-up) финансовых и результативных показателей до уровня региона или страны
- Привязка кампаний, активностей и статей бюджета к конкретным локациям

### 3. Расширенное управление KPI

**Требование:** Продвинутый модуль управления KPI:
- **Категоризация KPI** по типам: "Медийные", "Брендовые", "Продуктовые", "Финансовые", "Бизнес", "Командные"
- **Иерархия KPI** - моделирование влияния операционных метрик на цели верхнего уровня (например, как "рост установок" влияет на "+13% подсказанного знания")
- Привязка KPI к различным сущностям: Продуктам, Командам, Сотрудникам, Активностям
- Трекинг сложных метрик: Retention (1, 3, 7 дней), Detection Rate, MAU виджета, LTV
- Импорт продуктовых метрик из внешних систем аналитики

### 4. Управление командами и ресурсами

**Требование:** Модуль управления ресурсами:
- Создание профилей команд и сотрудников
- Аллокация FTE (Full-Time Equivalent) на продукты и маркетинговые кампании
- Планирование и отслеживание затрат на команду (ФОТ) как части общего бюджета
- Связывание ФОТ с таблицей Investments
- Разделение затрат на CAPEX и OPEX

### 5. Связь между охватными (ATL) и перформанс (Digital) активностями

**Требование:** Инструменты для моделирования и анализа кросс-канального влияния:
- Возможность связывать перформанс-активности с охватными для анализа корреляции
- Дашборды (Insights), визуально сопоставляющие временные шкалы ATL-активностей с графиками роста органики, брендового поиска и других ключевых метрик
- Отслеживание влияния охватных кампаний на перформанс-метрики

### 6. Детализированное медиапланирование

**Требование:** Расширенные возможности медиапланирования:
- **Справочник площадок** (Telegram-каналы, блогеры, сайты) с хранением ссылок, статистики (подписчики, охваты), прайс-листов
- Возможность в MediaPlanItems выбирать конкретную площадку из справочника
- Пользовательские типы каналов и форматов, не ограничиваясь стандартным списком
- Специфические единицы измерения для разных форматов ("кол-во выходов" для посевов, "хронометраж" для видео, "кол-во стикеров")

### 7. Гибкое управление временными периодами

**Требование:** 
- Точные даты старта и финиша для каждого размещения
- Визуализация на календаре (ActivityTimeline) отдельных "флайтов" и размещений внутри кампании
- Отображение пересечений и последовательности активностей

## Модификация существующих таблиц

| **Таблица** | **Новые/Измененные поля** | **Обоснование** |
|:---|:---|:---|
| **Activities** | `level: int`<br>`activity_class: Enum ['Program', 'Campaign', 'Flight', 'Tactic', 'Placement']`<br>`product_id: FK` (Products)<br>`geography_id: FK` (Geography) | Многоуровневая иерархия, привязка к продукту и географии |
| **ActivityTypes** | `default_kpi_set_id: FK` | Стандартный набор KPI для типа активности |
| **KPIs** | `kpi_category: Enum ['Media', 'Brand', 'Product', 'Financial', 'Business', 'Team']`<br>`parent_kpi_id: FK` (self-referencing) | Категоризация и иерархия KPI |
| **MediaPlanItems** | `placement_id: FK` (Placements)<br>`geography_id: FK`<br>`unit_of_measure: String`<br>`unit_cost: Decimal` | Детализация до площадки, география, гибкие единицы измерения |
| **MediaMixItems** | `geography_id: FK`<br>`unit_of_measure: String`<br>`unit_cost: Decimal` | География и гибкие единицы измерения |
| **Investments** | `product_id: FK`<br>`team_id: FK` (Teams)<br>`geography_id: FK`<br>`cost_type: Enum ['CAPEX', 'OPEX']` | Бюджетирование по продуктам, командам, географии, тип затрат |
| **Campaigns** | `product_id: FK` | Связь с продуктом на этапе ИИ-моделирования |

## Новые таблицы

| **№** | **Название** | **Описание** | **Ключевые поля** |
|:---|:---|:---|:---|
| 1 | **Products** | Справочник продуктов компании | `product_id: PK`<br>`name: String`<br>`product_owner_id: FK Users`<br>`status: Enum ['active', 'development', 'legacy']` |
| 2 | **Geography** | Иерархический справочник географических локаций | `geography_id: PK`<br>`name: String`<br>`parent_id: FK`<br>`type: Enum ['Country', 'Region', 'City']` |
| 3 | **Teams** | Справочник команд и их состав | `team_id: PK`<br>`name: String`<br>`team_lead_id: FK Users` |
| 4 | **TeamAllocations** | Аллокация ресурсов (FTE) команд | `allocation_id: PK`<br>`team_id: FK`<br>`product_id: FK`<br>`activity_id: FK`<br>`fte_allocated: Decimal`<br>`period: DateRange` |
| 5 | **Placements** | Справочник рекламных площадок | `placement_id: PK`<br>`name: String`<br>`url: String`<br>`category: String`<br>`subscribers: Integer`<br>`avg_reach: Integer` |
| 6 | **CrossChannelLinks** | Связи между активностями для моделирования взаимного влияния | `link_id: PK`<br>`source_activity_id: FK Activities`<br>`target_activity_id: FK Activities`<br>`link_type: Enum ['DrivesOrganic', 'DrivesBrandSearch']` |
| 7 | **ProductMetrics** | Фактические данные по продуктовым метрикам | `metric_id: PK`<br>`metric_name: String`<br>`value: Decimal`<br>`period: Date`<br>`platform: Enum ['Web', 'iOS', 'Android']` |
| 8 | **KPIHierarchies** | Взаимосвязи между KPI | `rule_id: PK`<br>`parent_kpi_id: FK KPIs`<br>`child_kpi_id: FK KPIs`<br>`influence_weight: Float` |
| 9 | **KPIAssignments** | Привязка KPI к различным сущностям | `assignment_id: PK`<br>`kpi_id: FK`<br>`entity_type: Enum ['Product', 'Team', 'User']`<br>`entity_id: String` |
| 10 | **Channels** | Гибкий справочник каналов | `channel_id: PK`<br>`name: String`<br>`type: Enum ['ATL', 'Digital', 'BTL']` |
| 11 | **AdFormats** | Гибкий справочник форматов размещения | `ad_format_id: PK`<br>`name: String`<br>`channel_id: FK` |
