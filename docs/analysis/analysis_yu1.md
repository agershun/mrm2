Система уже обладает мощным ядром для планирования, бюджетирования и моделирования кампаний. Однако анализ реальных, сложных федеральных кампаний, таких как кампания NUUM, выявляет ряд дополнительных требований, которые позволят системе более эффективно управлять маркетингом в крупных организациях.

Ниже приведены подробные требования и предложения по расширению функциональности и структуры данных вашей системы, основанные на этом анализе.

### Подробные требования к системе в дополнение к существующей функциональности

**1. Поддержка многоуровневой иерархии кампаний (Флайты и подпроекты):**
   *   **Анализ:** Кампания NUUM, хоть и называется "Федеральная РК", по сути является крупной программой, состоящей из множества подпроектов или "флайтов" с разными целями и механиками. Например, "Волна посевов мемного контента", "Оффлайн спецпроект в Авиапарке", коллаборация с "Я.Лавкой". План на Q1 также показывает несколько последовательных федеральных кампаний (ФРК).
   *   **Требование:** Система должна позволять создавать не просто кампанию и тактики под ней, а полноценную **многоуровневую иерархию**. Пользователь должен иметь возможность создать "Программу" (например, "NUUM Продвижение H1'24"), в нее вложить "Кампании/Флайты" ("ФРК Смотри — Снимай — Зарабатывай"), а уже в них — "Тактики" и "Размещения" (Наружная реклама, Посевы в Telegram и т.д.). Это позволит корректно агрегировать бюджеты и результаты на разных уровнях.

**2. Управление кампаниями по географическому признаку:**
   *   **Анализ:** Кампании NUUM и "СберЗдоровье" имеют четкое географическое деление: Москва, регионы, города-миллионники. Медиаплан также разделен по городам: Нижний Новгород, Пермь и т.д..
   *   **Требование:** Система должна поддерживать географию как ключевой атрибут на всех уровнях планирования. Необходимо иметь возможность:
        *   **Планировать бюджеты и KPI** в разрезе отдельных городов, регионов или групп городов (например, "Города-миллионники").
        *   **Фильтровать и группировать** активности в календаре и отчетах по географическому признаку.
        *   **Агрегировать (roll-up)** финансовые и результативные показатели до уровня региона или страны.

**3. Связь между охватными (ATL) и перформанс (Digital) активностями:**
   *   **Анализ:** Отчет по кампании NUUM наглядно демонстрирует, как охватные каналы (ТВ, наружная реклама) напрямую влияют на перформанс-метрики: рост брендовых запросов, органических установок и регистрации.
   *   **Требование:** Система должна предоставлять инструменты для **моделирования и анализа кросс-канального влияния**. Это выходит за рамки простого суммирования KPI. Требуется:
        *   Возможность **связывать перформанс-активности с охватными**, чтобы система могла анализировать корреляцию.
        *   **Дашборды (Insights)**, которые визуально сопоставляют временные шкалы ATL-активностей с графиками роста органики, брендового поиска и других ключевых метрик.

**4. Расширенное управление KPI:**
   *   **Анализ:** В кампаниях используется широкий спектр KPI: от медийных (охват, CPV) и брендовых (подсказанное знание) до продуктовых (рост регистраций, Retention, активность авторов и зрителей, рост в сторах).
   *   **Требование:** Необходимо расширить управление KPI, добавив:
        *   **Категоризацию KPI:** Разделение на "Медийные", "Брендовые", "Продуктовые", "Финансовые".
        *   **Иерархию KPI:** Возможность указывать, как KPI нижнего уровня (например, "рост установок") влияют на достижение KPI верхнего уровня ("+13% подсказанного знания").
        *   **Трекинг сложных метрик:** Возможность импортировать и отслеживать не только стандартные маркетинговые, но и продуктовые метрики (например, Retention 1, 3, 7 дня) из внешних систем аналитики.

**5. Поддержка различных типов медиа и форматов:**
   *   **Анализ:** В кампаниях задействовано огромное разнообразие каналов и форматов: от классических (ТВ, Радио, OOH) до специфических (посевы мемов, интеграции в YT-шоу, стикеры в метро, in-app).
   *   **Требование:** Справочники в системе должны быть максимально гибкими. Необходимо иметь возможность:
        *   Создавать **пользовательские типы каналов и форматов**, не ограничиваясь стандартным списком.
        *   Назначать специфические **единицы измерения** для разных форматов (например, "кол-во выходов" для посевов, "хронометраж" для видео).

**6. Гибкое управление временными периодами:**
   *   **Анализ:** Кампании имеют сложные временные рамки. Например, в наружной рекламе NUUM разные форматы запускались в разные даты в пределах одного месяца. Маркетинговый план на Q1 разбит на двухнедельные спринты.
   *   **Требование:** Система должна позволять:
        *   Задавать **точные даты старта и финиша** для каждой самой мелкой активности (размещения), а не только для кампании в целом.
        *   **Визуализировать на календаре (ActivityTimeline)** не только общую длительность кампании, но и отдельные "флайты" и размещения внутри нее, чтобы видеть их пересечения и последовательность.

### Какие дополнительные таблицы и поля нужны

Чтобы реализовать описанные выше требования, потребуется расширить существующую модель данных.

#### 1. Модификация существующих таблиц

| **Таблица** | **Новые/Измененные поля** | **Обоснование** |
| :--- | :--- | :--- |
| **Activities** | **`level: int`** <br> **`activity_class: Enum ['Program', 'Campaign', 'Flight', 'Tactic', 'Placement']`** <br> **`geography_id: FK` (связь с новым справочником Geography)** | Добавляет поддержку многоуровневой иерархии (программа -> кампания -> тактика). <br> Позволяет явно привязать любую активность к конкретному городу или региону. |
| **ActivityTypes** | **`default_kpi_set_id: FK`** | Позволяет при создании типа активности (например, "Наружная реклама") сразу привязывать к нему стандартный набор KPI (охват, частота). |
| **KPIs** (текущая) или **`ActivityKPIs`** (новая) | **`kpi_category: Enum ['Media', 'Brand', 'Product', 'Financial']`** | Необходимо для категоризации KPI и построения специализированных отчетов. |
| **MediaMixItems / MediaPlanItems** | **`geography_id: FK`** <br> **`unit_of_measure: String` (например, "GRP", "Выходы", "Кол-во стикеров")** <br> **`unit_cost: Decimal`** | Позволяет планировать медиамикс и медиаплан в разрезе географии. <br> Добавляет гибкость для нестандартных форматов размещения. |

#### 2. Новые таблицы

| **№** | **Название таблицы** | **Описание** | **Ключевые поля** | **Обоснование** |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **Geography** | Иерархический справочник географических локаций. | `geography_id: PK`<br>`name: String`<br>`parent_id: FK`<br>`type: Enum ['Country', 'Region', 'City']` | Централизует управление географией. Позволит строить отчеты, агрегируя данные с уровня города до страны. |
| 2 | **CrossChannelLinks** | Таблица для явной связи между активностями, чтобы моделировать их взаимное влияние. | `link_id: PK`<br>`source_activity_id: FK Activities`<br>`target_activity_id: FK Activities`<br>`link_type: Enum ['DrivesOrganic', 'DrivesBrandSearch']` | Реализует требование по отслеживанию влияния охватных кампаний на перформанс-метрики. |
| 3 | **ProductMetrics** | Хранит фактические данные по продуктовым метрикам, импортируемые из внешних систем. | `metric_id: PK`<br>`metric_name: String`<br>`value: Decimal`<br>`period: Date`<br>`platform: Enum ['Web', 'iOS', 'Android']` | Необходимо для отслеживания влияния маркетинга на ключевые продуктовые показатели, такие как Retention, CR в регистрацию, активность пользователей. |
| 4 | **KPIHierarchies** | Определяет взаимосвязи между KPI (как один KPI влияет на достижение другого). | `rule_id: PK`<br>`parent_kpi_id: FK KPIs`<br>`child_kpi_id: FK KPIs`<br>`influence_weight: Float` | Позволит строить модели, показывающие, как достижение операционных KPI (установки, регистрации) вносит вклад в достижение стратегического KPI (подсказанное знание). |
| 5 | **Channels & AdFormats** | Гибкие справочники для каналов и форматов, управляемые пользователем. | `channel_id: PK`<br>`name: String`<br>`type: Enum ['ATL', 'Digital', 'BTL']` <br><br> `ad_format_id: PK`<br>`name: String`<br>`channel_id: FK` | Заменит жестко заданные списки каналов и форматов на гибкие справочники, что позволит адаптировать систему под любые нестандартные размещения (интеграции, мемы, стикеры). |

Внедрение этих дополнений позволит вашей MRM-системе выйти за рамки стандартного планировщика и стать комплексным инструментом, способным эффективно управлять сложными, многоуровневыми и географически распределенными маркетинговыми кампаниями федерального масштаба.